image: node:18

pipelines:
  default:
    - step:
        name: Frontend Build and Test
        caches:
          - node
        script:
          - cd frontend
          - npm ci
          - npm run build
          - npm test -- --watchAll=false
    - step:
        name: Backend Build and Test
        caches:
          - node
        script:
          - cd backend
          - npm ci
          - npm test
    - step:
        name: Deploy to Production
        deployment: production
        trigger: manual # Manual trigger for safety until targets are defined
        script:
          - echo "Deploying to Production..."
          # Add actual deployment commands here e.g.
          # git push https://heroku:$HEROKU_API_KEY@git.heroku.com/$HEROKU_APP_NAME.git HEAD:master
          # or
          # curl -X POST $RENDER_DEPLOY_HOOK
